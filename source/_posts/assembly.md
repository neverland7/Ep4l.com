---
title: 汇编
date: 2021-01-20 22:26:10
img: https://cdn.jsdelivr.net/gh/neverland7/Ep4l.com/public/images/assembly/assembly.jpg
mathjax: true
summary: 持续更新中
categories: 学习笔记
tags:
  - assembly
typora-root-url: ..
---

<span style="color: #c31887;">把基本的都忘了，重新简单学一下，不深入，以后有时间再说</span>

使用的教材：汇编语言（第3版）王爽

<center><span style='color:blue;font-size:15px'>2021/1/20</span></center>

## 第1章 基础知识

汇编语言是直接在硬件之上工作的编程语言，需要有一定知识，但是在汇编课程中我们部队硬件系统进行全面和深入的研究，汇编课程的研究重点放在如何利用硬件系统的编程结构和指令集有效灵活地控制系统进行工作。

### 1.1 机器语言

机器语言是机器指令的集合，电子计算机的机器指令是一列二进制数字，每一种微处理器都有自己的机器指令集，也就是机器语言。

### 1.2 汇编语言的产生

汇编语言的主体是汇编指令，汇编指令是机器指令便于记忆的书写格式。

### 1.3 汇编语言的组成

（1）汇编指令：机器码的助记符，有相应的机器码。

（2）伪指令：没有对应的机器码，由编译器执行，计算机并不执行。

（3）其他符号：如+、-、*、/等，由编译器识别，没有对应的机器码。

汇编语言的核心是汇编指令，它决定了汇编语言的特性。

### 1.4 存储器

指令和数据在存储器中存放，也就是我们平时所说的内存。

### 1.5 指令和数据

指令和数据是应用上的概念。在内存或磁盘上，指令和数据没有任何区别，都是二讲制信息。CPU在工作的时候把有的信息看作指令，有的信息看作数据，为同样的信息服予了不同的意义。

### 1.6 存储单元

微型机存储器的存储单元可以存储一个Byte，即8个二进制位。

### 1.7 CPU对存储器的读写

CPU要想进行数据的读写，必须和外部器件(标准的说法是芯片)进行下面3类信息的交互。

- 存储单元的地址(地址信息)；
- 器件的选择，读或写的命令(控制信息)；
- 读或写的数据(数据信息)。

在计算机中专门有连接CPU和其他芯片的导线，通常称为总线。总线从物理上来讲，就是一根根导线的集合。根据传送信息的不同，总线从逻辑上又分为3类，**地址总线**、**控制总线**和**数据总线**。

CPU从3号单元中读取数据的过程如下：

![](https://cdn.jsdelivr.net/gh/neverland7/Ep4l.com/public/images/assembly/image-20210120230352328.png)

（1）CPU 通过地址线将地址信息3发出。
（2）CPU通过控制线发出内存读命令，选中存储器芯片，并通知它，将要从中读取数据。
（3）存储器将3号单元中的数据8通过数据线送入CPU。

### 1.8 地址总线

一个CPU有N跟地址总线，则可以说这个CPU的地址总线的宽度为N。这样的CPU最多可以寻找2的N次方个内存单元。

### 1.9 数据总线

数据总线的宽度决定了CPU和外界的数据传送速度。8 根数据总线一次可传送一个8位二进制数据(即一个字节)。16 根数据总线一次可传送两个字节。

### 1.10 控制总线

CPU对外部器件的控制是通过控制总线来进行的。在这里控制总线是个总称，控制总线是一些不同控制线的集合。有多少根控制总线，就意味着CPU提供了对外部器件的多少种控制。所以，控制总线的宽度决定了CPU对外部器件的控制能力。
前面所讲的内存读或写命令是由几根控制线综合发出的，其中有一根称为 “读信号输出”的控制线负贵由CPU向外传送读信号，CPU向该控制线上输出低电平表示将要读取数据；有一根称为“写信号输出”的控制线则负责传送写信号。

### 1.11 内存地址空间（概述）

举例来讲，一个CPU的地址总线宽度为10，那么可以寻址1024个内存单元，这1024 个可寻到的内存单元就构成这个CPU的内存地址空间。下面进行深入讨论。首先需要介绍两部分基本知识，主板和接口卡。

### 1.12 主板

在每一台PC机中，都有一个主板，主板上有核心器件和一些主要器件，这些器件通过总线(地址总线、数据总线、控制总线)相连。这些器件有**CPU**、**存储器**、**外围芯片组**（北桥负责高速信号，比如CPU与内存、显卡等设备的通信。南桥负责低速信号，比如PCI/PCIe、SATA、USB等外围设备通信。再后来北桥芯片逐渐被集成到了CPU里面。**芯片组的主要差别就是CPU对外围设备和拓展支持情况的差别**）、扩展插槽等。扩展插槽上一般插有RAM内存条和各类接口卡。

### 1.13 接口卡

CPU对外部设备都不能直接控制，直接控制这些设备进行工作的是插在扩展插槽上的接口卡。
简单地讲，就是CPU通过总线向接口卡发送命令，接口卡根据CPU的命令控制外设进行工作。

### 1.14 各类存储器芯片

一台PC机中，装有多个存储器芯片，这些存储器芯片从物理连接上看是独立的、不同的器件。从读写属性上看分为两类：**随机存储器**(RAM)和**只读存储器**(ROM)。 随机存储器可读可写，但必须带电存储，关机后存储的内容丢失；只读存储器只能读取不能写入，关机后其中的内容不丢失。这些存储器从功能和连接上又可分为以下几类。

- 随机存储器
  用于存放供CPU使用的绝大部分程序和数据。

- 装有BIOS(Basic Input/Output System,基本输入/输出系统)的ROM
  BIOS是由主板和各类接口卡(如显卡、网卡等)厂商提供的软件系统，可以通过它利用该硬件设备进行最基本的输入输出。在主板和某些接口卡上插有存储相应BIOS的ROM。例如，主板上的ROM中存储着主板的BIOS(通常称为系统BIOS)；显卡上的ROM中存储着显卡的BIOS；如果网卡上装有ROM，那其中就可以存储网卡的BIOS。
- 接口卡上的RAM
  某些接口卡需要对大批量输入、输出数据进行暂时存储，在其上装有RAM。最典型的是显示卡上的RAM，一般称为显存。显示卡随时将显存中的数据向显示器上输出。换句话说，我们将需要显示的内容写入显存，就会出现在显示器上。

![](https://cdn.jsdelivr.net/gh/neverland7/Ep4l.com/public/images/assembly/image-20210120235427070.png)

### 1.15 内存地址空间

上述的那些存储器，在物理上是独立的器件，但是在以下两点上相同。

- 都和CPU的总线相连。
- CPU对它们进行读或写的时候都通过控制线发出内存读写命令。

这也就是说，CPU 在操控它们的时候，把它们都当作内存来对待，把它们总的看作一个由若干存储单元组成的逻辑存储器，这个逻辑存储器就是我们所说的内存地址空间。在汇编这门课中，我们所面对的是内存地址空间。

![](https://cdn.jsdelivr.net/gh/neverland7/Ep4l.com/public/images/assembly/image-20210120235904993.png)

在图1.8中，所有的物理存储器被看作一个由若干存储单元组成的逻辑存储器，每个物理存储器在这个逻辑存储器中占有一个地址段，即一段地址空间。CPU在这段地址空间中读写数据，实际上就是在相对应的物理存储器中读写数据。

假设，图1.8中的内存地址空间的地址段分配如下。
地址0~7FFFH的32KB空间为主随机存储器的地址空间:
地址8000H~9FFFH的8KB空间为显存地址空间:
地址A000H~FFFFH的24KB空间为各个ROM的地址空间。

这样，CPU向内存地址为1000H的内存单元中写入数据，这个数据就被写入主随机存储器中；CPU向内存地址为8000H的内存单元中写入数据，这个数据就被写入显存中，然后会被显卡输出到显示器上；CPU向内存地址为C000H的内存单元中写入数据的操作是没有结果的，C000H 单元中的内容不会被改变，C000H 单元实际上就是ROM存储器中的一个单元。

内存地址空间的大小受CPU地址总线宽度的限制。80386CPU 的地址总线宽度为32，其内存地址空间最大为4GB。

我们在基于一个计算机硬件系统编程的时候，必须知道这个系统中的内存地址空间分配情况。不同的计算机系统的内存地址的分配情况是不同的。

<center><span style='color:blue;font-size:15px'>2021/1/23</span></center>

## 第2章 寄存器

一个典型的CPU由运算器、控制器、寄存器等器件构成，这些器件靠内部总线相连。
对一个汇编程序员来说，CPU中的主要部件是寄存器。

### 2.1 通用寄存器

8086CPU的所以寄存器都是16位的，可以存放两个字节。AX、BX、CX、DX这4个寄存器通常用来存放一般性的数据，被称为**通用寄存器**。
为了向上一代的8位CPU寄存器兼容，这4个通用寄存器都可分为两个独立使用的8位寄存器来用。
例如：AX可分为AH（高8位）和AL（低8位）

### 2.2 字在寄存器中的存储

出于对兼容性的考虑，8086CPU可以一次性处理以下两种尺寸的数据

- 字节：记为byte，由8个bit组成
- 字：记为word，一个字由两个字节组成，这两个字节分别称为这个字的高位字节和低位字节

出于对数据直观分析的需要，我们多用十六进制来表示一个数据

### 2.3 几条汇编指令

| 程序段中的指令 | 指令执行后AX中的数据 | 指令执行后BX中的数据 |
| :------------: | :------------------: | :------------------: |
|  mov ax,4E20H  |        4E20H         |        0000H         |
|  add ax,106H   |        6226H         |        0000H         |
|  mov bx,2000H  |        6226H         |        2000H         |
|   add ax,bx    |        8226H         |        2000H         |
|   mov bx,ax    |        8226H         |        8226H         |
|   add ax,bx    |      **044CH**       |        8226H         |

最后一条指令所得的值应该为1044CH，但是ax寄存器放不下，最高位的1不能保存

| 程序段中的指令 | 指令执行后AX中的数据 | 指令执行后BX中的数据 |
| :------------: | :------------------: | :------------------: |
|  mov ax,001AH  |        001AH         |        0000H         |
|  mov bx,0026H  |        001AH         |        0026H         |
|   add al,bl    |        0040H         |        0026H         |
|   add ah,bl    |        2640H         |        0026H         |
|   add bh,al    |        2640H         |        4026H         |
|    mov ah,0    |        0040H         |        4026H         |
|   add al,85H   |        00C5H         |        4026H         |
|   add al,93H   |      **0058H**       |        4026H         |


最后的ax应该为158H，但此时的al是作为一个独立的8位寄存器来使用的，和ah没有关系，所以最高位丢失

在进行数据传送或运算时，要注意指令的两个操作对象的位数应当是一致的。

### 2.4 物理地址

每个内存单元在存储空间内都有唯一的地址，称为物理地址。
在CPU向地址总线上发出物理地址之前，必须要在内部先形成这个物理地址。不同的CPU可以有不同的形成物理地址的方式。

### 2.5 16位结构的CPU

什么是16位结构的CPU呢？

- 运算器一次最多可以处理16位的数据
- 寄存器的最大宽度为16位
- 寄存器和运算器之间的通路为16位

内存单元的地址在送上地址总线之前，必须在CPU中处理、传输、暂时存放，对于16位CPU，能一次性处理，传输、暂时存储16位的地址。

<center><span style='color:blue;font-size:15px'>2021/1/24</span></center>

### 2.6 8086CPU给出物理地址的方法













